<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Slots</title>
<style>
    body {
        background: linear-gradient(135deg, #1e1e2f, #2b2b45);
        color: white;
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
    }

    .slot-machine {
        background: #111;
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 0 30px #000;
        text-align: center;
        width: 420px;
    }

    .reels {
        display: flex;
        justify-content: space-between;
        margin: 20px 0;
    }

    .reel {
        background: #222;
        width: 80px;
        height: 80px;
        font-size: 50px;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 10px;
        box-shadow: inset 0 0 10px #000;
        transition: transform 0.1s ease;
    }

    button {
        padding: 12px 25px;
        font-size: 18px;
        border: none;
        border-radius: 10px;
        background: gold;
        color: black;
        cursor: pointer;
        font-weight: bold;
        transition: 0.2s;
        margin: 5px;
    }

    button:hover {
        background: orange;
    }

    .money {
        margin-top: 10px;
        font-size: 22px;
    }

    .result {
        margin-top: 15px;
        font-size: 20px;
        height: 30px;
    }
</style>
</head>
<body>

<div class="slot-machine">
    <h1>üé∞ Slot Machine</h1>
    <div class="reels">
        <div class="reel" id="reel1">üçí</div>
        <div class="reel" id="reel2">üçã</div>
        <div class="reel" id="reel3">üçä</div>
    </div>
    <div class="money" id="money">üí∞ Money: $100</div>
    <button onclick="spin()">SPIN ($10)</button>
    <button onclick="window.location='../../content/pages/section1.html'">‚¨Ö Back</button>
    <div class="result" id="result"></div>

    <!-- Sounds -->
    <audio id="spinSound" src="./spin.mp3"></audio>
    <audio id="winSound" src="./win.mp3"></audio>
    <audio id="jackpotSound" src="./jackpot.mp3"></audio>
</div>

<script>
    // Weighted symbols: {symbol: weight}
    const weightedSymbols = [
        {symbol: "üçí", weight: 35}, // very common
        {symbol: "üçã", weight: 30},
        {symbol: "üçä", weight: 20},
        {symbol: "‚≠ê", weight: 10},
        {symbol: "üíé", weight: 4},  // rare
        {symbol: "7Ô∏è‚É£", weight: 1}  // extremely rare
    ];


    let money = 100;
    const costPerSpin = 10;

    function updateMoney() {
        document.getElementById("money").textContent = `üí∞ Money: $${money}`;
    }

    function playSound(id, volume=0.5) {
        const sound = document.getElementById(id);
        if (sound) {
            sound.currentTime = 0; // rewind to start
            sound.volume = volume; // set volume
            sound.play().catch(err => {
                console.log("Sound failed to play:", err);
            });
        }
    }


    // Get random symbol based on weights
    function getRandomSymbol() {
        const totalWeight = weightedSymbols.reduce((sum, s) => sum + s.weight, 0);
        let random = Math.random() * totalWeight;
        for (let s of weightedSymbols) {
            if (random < s.weight) return s.symbol;
            random -= s.weight;
        }
        return weightedSymbols[0].symbol; // fallback
    }

    function spin() {
        if(money < costPerSpin){
            document.getElementById("result").textContent = "üí∏ Not enough money! Resetting...";
            money = 100;
            updateMoney();
            return;
        }

        money -= costPerSpin; // pay for spin
        updateMoney();

        const reel1 = document.getElementById("reel1");
        const reel2 = document.getElementById("reel2");
        const reel3 = document.getElementById("reel3");
        const result = document.getElementById("result");
        result.textContent = "";

        let spins = 15;
        const interval = setInterval(() => {
            playSound("spinSound");
            reel1.textContent = getRandomSymbol();
            reel2.textContent = getRandomSymbol();
            reel3.textContent = getRandomSymbol();
            spins--;

            if(spins <= 0){
                clearInterval(interval);

                // Check combinations
                const symbolsSpun = [reel1.textContent, reel2.textContent, reel3.textContent];
                let payout = 0;
                let message = "Try Again! üí∏";

                // Triple match
                if(symbolsSpun[0] === symbolsSpun[1] && symbolsSpun[1] === symbolsSpun[2]){
                    if(symbolsSpun[0] === "7Ô∏è‚É£") payout = 200;
                    else if(symbolsSpun[0] === "üíé") payout = 100;
                    else payout = 50;
                    message = `üéâ JACKPOT! ${symbolsSpun[0]} +$${payout}`;
                    playSound("jackpotSound");

                // Two of a kind
                } else if(symbolsSpun[0] === symbolsSpun[1] || symbolsSpun[1] === symbolsSpun[2] || symbolsSpun[0] === symbolsSpun[2]){
                    payout = 5;
                    message = `‚ú® Small Win! +$${payout}`;
                    playSound("winSound");
                }

                money += payout;
                result.textContent = message;

                // Reset if broke
                if(money <= 0){
                    result.textContent += " üí∏ You went broke! Resetting...";
                    money = 100;
                }

                updateMoney();
            }

        }, 100);
    }
</script>
</body>
</html>
